# 機能
本ソフトウェアは配信ソフトOBSにゲームコントローラーの入力を表示するために開発しました。  

ゲームコントローラーでどのボタンを押しているかをグラフィック表示したり、キーログ（キーディスプレイ）表示ができるようになります。  

入力情報の取得はGamepad API（Web API）を使用しているため、**XInput未対応のゲームコントローラーやキーボードなどには対応しておりません**。  

# 使い方
配信ソフトOBSのソースに、本ソフトウェア（index.html）を「ブラウザ」として設定することで使用できるようになります。  

その際はブラウザソースのプロパティの「URL」に「`http://absolute/C:/GameInputDisplay/index.html`」のように設定してください（ローカルファイルパスの頭に「`http://absolute/`」をつける）。  
**「ローカルファイル」として設定するとパラメーター設定ができなくなるので注意**してください。  

ダウンロードせずに「`https://codelelou.github.io/GameInputDisplay/index.html`」と設定することでも動作はしますが、オフライン環境やサーバーが落ちている時などは使用できませんし、処理に遅延が発生する場合があります。  

## サイズ・表示位置の調整
ゲームコントローラーかキーログの一方のみを表示する場合は、配信ソフトのソース管理機能でサイズを変更しお好みの位置に移動させる方法が簡単です。  

両方を表示する場合は、カスタムCSSでサイズ・表示位置の調整ができます。  

ゲームコントローラーとキーログをそれぞれ別のブラウザソースとして設定することもできますが、本ソフトウェアが2つ同時に起動することになりパフォーマンスは落ちます。  
参照コピーで工夫することでサイズ・表示位置を調整することは可能です（参照コピーであれば複数起動は防げます）。  

### カスタムCSSでサイズ・表示位置を調整
まずは本ソフトウェアのプロパティの「幅」と「高さ」を配信画面と同じにし、画面全体に表示されるようにします。  
例えば配信画面が1920×1080であれば、幅を「1920」に、高さを「1080」にします。  

そして「カスタムCSS」に次のCSSを追記します。  
~~~
#GIDKeyLog {  /* キーログ */
  zoom: 200%;  /* 拡大縮小（他の設定にも影響します） */
  top: 0px;  /* 縦方向の移動（マイナス値も設定可能） */
  left: 300px;  /* 横方向の移動（マイナス値も設定可能） */
  opacity: 0.3;  /* 透明度（「0」にすると見えなくなる */
}

#GIDGameController {  /* ゲームコントローラー */
  top: 910px;  /* 縦方向の移動（マイナス値も設定可能） */
  left: 50px;  /* 横方向の移動（マイナス値も設定可能） */
  width: 400px;  /* 横幅 */
}
~~~
ご自身の配信レイアウトに応じて、お好みで数値は調整してください。  
**キーログはゲームコントローラーの入力がないと表示されない**ので注意してください（ゲームの起動は不要です）。

キーログの表示数はパラメーター設定の「log」で変更できます。  

# パラメーター設定
本ソフトウェアの各種設定は、「`index.html?delay=4&log=20&excludes=8,9,11&style=DualPad`」のようにパラメーターから指定できます。  
**スペースや全角などが含まれているような場合は、正常に本ソフトウェアが動作しない場合があります**。  

## modes
既定値：Controller,KeyLog  

コントローラーかキーログのどちらか一方のみを表示したい場合は「`index.html?modes=Controller`」のように指定します。  

デバッグモード（「`index.html?modes=Debug`」）が有効の場合は、コントローラーもキーログも両方表示されます。  
デバッグモードでは各パラメーターの設定情報の確認と、パソコンに繋いでいるコントローラーの情報（接続Indexやボタン番号など）を確認できます。  

### modes値
- Controller
- KeyLog
- Debug

## controller
既定値：0  

複数のコントローラーを繋いでいる場合は、入力を表示したいコントローラーのIndexを指定してください。  
デバッグモードで接続中のゲームコントローラーのIndexを確認することができます。  

## delay
既定値：8

本ソフトウェアは一定間隔でゲームコントローラーの情報を取得しており、その間隔をミリ秒で指定することができます。  

**間隔が短すぎるとパソコンに過度の負荷が掛かったり、ブラウザの制約などにより指定した間隔で動作しない**場合があります。  
4ミリ秒未満を指定した場合は、ブラウザの内部処理で4ミリ秒間隔として処理が行われるようです。  

## log
既定値：100

キーログの表示件数を指定します。  
最大「100件」に対応しています。

## excludes
既定値はありません。  

入力を無視したいボタンの番号を「`index.html?excludes=8,9,11`」のように、半角カンマ区切りで指定します。  
これは本ソフトウェア用の設定のため、**プレイ中のゲームなどには影響しません**。  

## styles
既定値：Front6Pad  

コントローラースキンやキーログ用キーコンフィグプリセットの指定ができます。  

キーコンフィグプリセットを指定する際は、「`index.html?styles=Front6Pad,B0LK_B1MK_B2LP_B3MP_B4Throw_B5HP_B6VShift_B7HK`」のように半角カンマ区切りでコントローラースキンも指定してください。  
**コントローラースキンが未設定状態の場合はコントローラーが表示されない**場合があります。  

### コントローラースキン
- Front6Pad（既定・6ボタンゲームパッド風）
- ArcadeController（アーケードコントローラー風）
- ButtonBox（HitBox・レバーレスコントローラー風）
- DualBox（HitBoxCrossUp風）
- DualPad（DualShock・DualSense風）

標準でこれらのコントローラースキンを指定できます。  

# キーログ（キーディスプレイ）
キーコンフィグはCSSでカスタマイズ可能です。  

初期設定のキーコンフィグは次の通りです（対戦格闘アクションゲーム「ストリートファイターV」での使用を想定したキーコンフィグになっています）。  

ボタン0 = 弱キック  
ボタン1 = 中キック  
ボタン2 = 弱パンチ  
ボタン3 = 中パンチ  
ボタン4 = 弱中強パンチ同時押し  
ボタン5 = 強パンチ  
ボタン6 = 弱中強キック同時押し  
ボタン7 = 強キック  

コントローラースキンが「DualPad」の場合の初期キーコンフィグは次の通りです。  

ボタン0 = 弱キック  
ボタン1 = 中キック  
ボタン2 = 弱パンチ  
ボタン3 = 中パンチ  
ボタン4 = 強パンチ  
ボタン5 = 強キック  
ボタン6 = 弱中強パンチ同時押し  
ボタン7 = 弱中強キック同時押し  

独自のキーコンフィグを設定したい場合は、カスタムCSSで設定してください。  
配信ソフトOBSの場合は、ソース内の本ソフトウェアのプロパティを開くことで「カスタムCSS」を設定できます。

標準でキーコンフィグプリセットを用意しており、「`index.html?styles=ArcadeController,B0LK_B1MK_B2LP_B3MP_B4Throw_B5HP_B6VTrigger_B7HK`」のようにパラメーターで指定することができます。  
**「styles」パラメーターを指定する時は、コントローラースキンの指定を忘れない**ようにしてください（キーログのみ指定するとコントローラーが表示されない場合があります）。  

標準で用意しているキーコンフィグのプリセットは次の通りです（独自のキーコンフィグの設定する際の参考にもなるかと思います）。  

## B0LK_B1MK_B2LP_B3MP_B4Throw_B5HP_B6VTrigger_B7HK
ボタン0 = 弱キック  
ボタン1 = 中キック  
ボタン2 = 弱パンチ  
ボタン3 = 中パンチ  
ボタン4 = 弱パンチ・弱キック同時押し  
ボタン5 = 強パンチ  
ボタン6 = 強パンチ・強キック同時押し  
ボタン7 = 強キック  

## B0LK_B1MK_B2LP_B3MP_B4Throw_B5HP_B6VShift_B7HK
ボタン0 = 弱キック  
ボタン1 = 中キック  
ボタン2 = 弱パンチ  
ボタン3 = 中パンチ  
ボタン4 = 弱パンチ・弱キック同時押し  
ボタン5 = 強パンチ  
ボタン6 = 強パンチ・中キック同時押し  
ボタン7 = 強キック  

## Front6PadForLelouGuile
ボタン0 = 弱キック  
ボタン1 = 中キック  
ボタン2 = 弱パンチ  
ボタン3 = 中パンチ  
ボタン4 = 強パンチ  
ボタン5 = 弱中パンチ同時押し  
ボタン6 = 強キック  
ボタン7 = 弱中キック同時押し  
ボタン10 = 十字キー上入力  

# オリジナルのコントローラースキンの作り方
本ソフトウェアをダウンロードしてご利用の場合は、スキンの画像ファイルを直接編集することでオリジナルスキンを自作することが可能です。  

画像の寸法は同一スキンで使用する画像がすべて同じであれば、変更可能です（自動的にサイズ調整して表示されます）。  
**寸法が異なる画像があるとCSSなどで表示位置の調整が必要になる**場合があります。

スキンはベースとなる「Base.png」と押したボタンの差分画像の組み合わせで構成しています。  
なお、スキンフォルダ内の「Active.png」は差分画像ファイルを作成する時に使用したもので、スキンの表示には使用していないため削除しても大丈夫です。  

# Author
[神戸ルル（Code Lelou）](https://twitter.com/codelelou)
